---
title: "React Router v7 ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒª Zodix ã‚’ Zod v3/v4 ä¸¡å¯¾å¿œã«ã—ã¦ã¿ãŸ"
emoji: "ğŸš€"
type: "tech"
topics: ["reactrouter", "zod", "typescript", "opensource", "remix"]
published: true
---

## Zodix ã‚’ fork ã—ã¦æ”¹è‰¯ã—ã¦ã¿ã¾ã—ãŸ

React Router v7ï¼ˆæ—§ Remixï¼‰ã§ãƒ•ã‚©ãƒ¼ãƒ ã‚„ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€Œ[Zodix](https://github.com/rileytomasek/zodix)ã€ã‚’ fork ã—ã¦ã€Zod v3/v4 ä¸¡å¯¾å¿œã¨ React Router v7 å¯¾å¿œã«ã—ã¦ã¿ã¾ã—ãŸã€‚NPM ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦ `@coji/zodix` ã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚

https://github.com/coji/zodix

https://www.npmjs.com/package/@coji/zodix

## ãªãœ fork ã—ãŸã®ã‹

ã‚ªãƒªã‚¸ãƒŠãƒ«ã® Zodix ã¯ä¾¿åˆ©ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã‚“ã§ã™ãŒã€ä½¿ã£ã¦ã„ã¦å›°ã£ãŸã“ã¨ãŒã„ãã¤ã‹ã‚ã‚Šã¾ã—ãŸã€‚

### 1. Zod v3 ã‹ã‚‰ v4 ã¸ã®ç§»è¡Œå•é¡Œ

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚ˆã£ã¦ Zod ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒé•ã†ã‚“ã§ã™ã‚ˆã­ã€‚å¤§è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã ã¨ã€ä¾å­˜é–¢ä¿‚ã®éƒ½åˆã§ç°¡å˜ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã§ããªã„ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚Zod v3 ã¨ v4 ã¯äº’æ›æ€§ãŒãªã„ã®ã§ã€ä¸¡æ–¹ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ãŸã‹ã£ãŸã‚“ã§ã™ã€‚

### 2. React Router v7 ã¸ã®å¯¾å¿œ

Remix ãŒ React Router v7 ã«çµ±åˆã•ã‚ŒãŸã“ã¨ã«ä¼´ã„ã€`@remix-run` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¸ã®ä¾å­˜ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Š Remix ã§ã‚‚ React Router v7 ã§ã‚‚ã€ã©ã¡ã‚‰ã§ã‚‚ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

### 3. ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹çŠ¶æ³

ã‚ªãƒªã‚¸ãƒŠãƒ«ã®ãƒªãƒã‚¸ãƒˆãƒªã¯æ›´æ–°ãŒæ­¢ã¾ã£ã¦ã„ã¦ã€Issue ã‚„ PR ã¸ã®å¯¾å¿œã‚‚æ»ã£ã¦ã„ã‚‹çŠ¶æ…‹ã§ã—ãŸã€‚å®Ÿéš›ã«ä½¿ã£ã¦ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚‹ã®ã§ã€è‡ªåˆ†ã§ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã—ãŸã‹ã£ãŸã‚“ã§ã™ã€‚

## å®Ÿè£…ã®å·¥å¤«

### Zod v3/v4 ä¸¡å¯¾å¿œã®ä»•çµ„ã¿

Zod v3 ã¨ v4 ã®éäº’æ›æ€§ãŒä¸€ç•ªã®èª²é¡Œã§ã—ãŸã€‚ä¸¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§å‹å®šç¾©ãŒé•ã†ã®ã§ã€å˜ç´”ã«æ¡ä»¶åˆ†å²ã§ã¯å¯¾å¿œã§ããªã„ã‚“ã§ã™ã‚ˆã­ã€‚

çµå±€ã€**åˆ¥ã€…ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹**ã‚’æä¾›ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

```typescript
// Zod v3 ã‚’ä½¿ã†å ´åˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
import { zx } from '@coji/zodix'

// Zod v4 ã‚’ä½¿ã†å ´åˆ
import { zx } from '@coji/zodix/v4'
```

`package.json` ã® exports ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã€ãã‚Œãã‚Œã®ãƒ‘ã‚¹ã«å¯¾å¿œã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šï¼š

```json
{
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "import": "./dist/index.js",
      "require": "./dist/index.cjs"
    },
    "./v4": {
      "types": "./dist/v4.d.ts",
      "import": "./dist/v4.js",
      "require": "./dist/v4.cjs"
    }
  }
}
```

å†…éƒ¨ã§ã¯ã€v3 ç”¨ã¨ v4 ç”¨ã§åˆ¥ã€…ã®å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ï¼š

```
src/
â”œâ”€â”€ parsers.v3.ts    # Zod v3 ç”¨ã®ãƒ‘ãƒ¼ã‚µãƒ¼å®Ÿè£…
â”œâ”€â”€ parsers.v4.ts    # Zod v4 ç”¨ã®ãƒ‘ãƒ¼ã‚µãƒ¼å®Ÿè£…
â”œâ”€â”€ schemas.v3.ts    # Zod v3 ç”¨ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚¹ã‚­ãƒ¼ãƒ
â”œâ”€â”€ schemas.v4.ts    # Zod v4 ç”¨ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚¹ã‚­ãƒ¼ãƒ
â”œâ”€â”€ v3.ts           # v3 ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
â””â”€â”€ v4.ts           # v4 ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
```

ã“ã‚Œã ã¨ä»¥ä¸‹ã®ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™ï¼š
- **å®Œå…¨ãªå‹å®‰å…¨æ€§** - ãã‚Œãã‚Œã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§æ­£ã—ã„å‹ãŒé©ç”¨ã•ã‚Œã‚‹
- **ãƒ“ãƒ«ãƒ‰æ™‚ã®æœ€é©åŒ–** - ä½¿ã‚ãªã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚³ãƒ¼ãƒ‰ã¯å«ã¾ã‚Œãªã„
- **ç§»è¡ŒãŒç°¡å˜** - ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹ã‚’å¤‰ãˆã‚‹ã ã‘ã§ v3 ã‹ã‚‰ v4 ã«ç§»è¡Œå¯èƒ½

### React Router v7 / Remix ä¸¡å¯¾å¿œ

`@remix-run` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¸ã®ä¾å­˜ã‚’å‰Šé™¤ã—ã€ã©ã¡ã‚‰ã§ã‚‚ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸï¼š

```typescript
// Remix ã§ã‚‚
import type { LoaderFunctionArgs } from '@remix-run/node'

export async function loader({ params }: LoaderFunctionArgs) {
  const { postId } = zx.parseParams(params, {
    postId: zx.NumAsString
  })
  // ...
}

// React Router v7 ã§ã‚‚
import type { Route } from './+types.posts.$postId'

export async function loader({ params }: Route.LoaderArgs) {
  const { postId } = zx.parseParams(params, {
    postId: zx.NumAsString
  })
  // ...
}
```

## ä½¿ã„æ–¹

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install @coji/zodix zod
```

### åŸºæœ¬çš„ãªä½¿ã„æ–¹

React Router v7 ã®ãƒ«ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ï¼š

```typescript
import { z } from 'zod'
import { zx } from '@coji/zodix' // Zod v3
// import { zx } from '@coji/zodix/v4' // Zod v4

// ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
export async function loader({ params }: Route.LoaderArgs) {
  const { userId, postId } = zx.parseParams(params, {
    userId: z.string(),
    postId: zx.NumAsString // "123" â†’ 123
  })
  
  // userIdã¨postIdã¯å‹å®‰å…¨ã«ä½¿ãˆã‚‹
  const post = await getPost(userId, postId)
  return { post }
}

// ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
export async function action({ request }: Route.ActionArgs) {
  const data = await zx.parseForm(request, {
    title: z.string().min(1),
    content: z.string().min(10),
    published: zx.CheckboxAsString // "on" â†’ true
  })
  
  // dataã¯å®Œå…¨ã«å‹ä»˜ã‘ã•ã‚Œã¦ã„ã‚‹
  await createPost(data)
  return { success: true }
}
```

### ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚¹ã‚­ãƒ¼ãƒ

HTML ãƒ•ã‚©ãƒ¼ãƒ ã‚„ URL ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯å…¨ã¦æ–‡å­—åˆ—ãªã®ã§ã€æ•°å€¤ã‚„ãƒ–ãƒ¼ãƒ«å€¤ã¸ã®å¤‰æ›ãŒå¿…è¦ã§ã™ã‚ˆã­ã€‚Zodix ã«ã¯ä¾¿åˆ©ãªãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚¹ã‚­ãƒ¼ãƒãŒã‚ã‚Šã¾ã™ï¼š

```typescript
// æ•°å€¤ã¨ã—ã¦æ‰±ã†
zx.NumAsString    // "3.14" â†’ 3.14
zx.IntAsString    // "42" â†’ 42 (æ•´æ•°ã®ã¿)

// ãƒ–ãƒ¼ãƒ«å€¤ã¨ã—ã¦æ‰±ã†
zx.BoolAsString      // "true" â†’ true, "false" â†’ false
zx.CheckboxAsString  // "on" â†’ true, undefined â†’ false
```

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã¯è‡ªå‹•çš„ã« 400 ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦å‡¦ç†ã•ã‚Œã¾ã™ï¼š

```typescript
export async function loader({ params }: Route.LoaderArgs) {
  // postIdãŒæ•°å€¤ã§ãªã„å ´åˆã€400ã‚¨ãƒ©ãƒ¼ã‚’ã‚¹ãƒ­ãƒ¼
  const { postId } = zx.parseParams(
    params,
    { postId: zx.NumAsString },
    { message: "Invalid post ID" }
  )
}

// ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒå¿…è¦ãªå ´åˆ
export async function action({ request }: Route.ActionArgs) {
  const result = await zx.parseFormSafe(request, {
    email: z.string().email()
  })
  
  if (!result.success) {
    return { error: result.error.flatten() }
  }
  
  // result.data ã‚’ä½¿ã£ã¦å‡¦ç†
}
```

## Zod v3 ã‹ã‚‰ v4 ã¸ã®ç§»è¡Œ

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ Zod v4 ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹éš›ã®æ‰‹é †ï¼š

1. Zod ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
```bash
npm install zod@^4.0.0
```

2. Zodix ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹ã‚’å¤‰æ›´
```typescript
// Before
import { zx } from '@coji/zodix'

// After
import { zx } from '@coji/zodix/v4'
```

3. å¿…è¦ã«å¿œã˜ã¦ Zod ã‚¹ã‚­ãƒ¼ãƒã‚’æ›´æ–°ï¼ˆ[Zod v4 ã®å¤‰æ›´ç‚¹](https://zod.dev/v4/changelog)ã‚’å‚ç…§ï¼‰

ã“ã‚Œã ã‘ã§ç§»è¡Œå®Œäº†ã§ã™ï¼

## å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®æ´»ç”¨ä¾‹

React Router v7 ã® SPA ãƒ¢ãƒ¼ãƒ‰ã§ã‚‚å•é¡Œãªãå‹•ä½œã—ã¾ã™ã€‚å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½¿ç”¨ã—ã¦ã„ã‚‹ä¾‹ï¼š

```typescript
// routes/posts.$postId.edit.tsx
import { zx } from '@coji/zodix/v4'
import type { Route } from './+types.posts.$postId.edit'

export async function action({ params, request }: Route.ActionArgs) {
  const { postId } = zx.parseParams(params, {
    postId: zx.NumAsString
  })
  
  const formData = await zx.parseForm(request, {
    title: z.string().min(1, "ã‚¿ã‚¤ãƒˆãƒ«ã¯å¿…é ˆã§ã™"),
    content: z.string().min(10, "æœ¬æ–‡ã¯10æ–‡å­—ä»¥ä¸Šå¿…è¦ã§ã™"),
    tags: z.array(z.string()).optional()
  })
  
  await updatePost(postId, formData)
  return redirect(`/posts/${postId}`)
}
```

## ã¾ã¨ã‚

Zodix ã‚’ fork ã—ã¦ã€Zod v3/v4 ã®ä¸¡å¯¾å¿œã¨ React Router v7 å¯¾å¿œã‚’å®Ÿç¾ã§ãã¾ã—ãŸã€‚åˆ¥ã€…ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹ã§å‹å®‰å…¨æ€§ã‚’ç¶­æŒã—ã¤ã¤ã€ç°¡å˜ã«ç§»è¡Œã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

React Router v7 ã§ãƒ•ã‚©ãƒ¼ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ã„ãŸã„æ–¹ã¯ã€`@coji/zodix` ã‚’è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚‚ãŠå¾…ã¡ã—ã¦ã„ã¾ã™ï¼

## å‚è€ƒè¨˜äº‹

Zodix ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã«ã¤ã„ã¦ã¯ã€ä»¥å‰æ›¸ã„ãŸã“ã¡ã‚‰ã®è¨˜äº‹ã‚‚å‚è€ƒã«ã—ã¦ãã ã•ã„ï¼š

https://zenn.dev/coji/articles/zodix-introduction

## ãƒªãƒ³ã‚¯

- [GitHub ãƒªãƒã‚¸ãƒˆãƒª](https://github.com/coji/zodix)
- [NPM ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸](https://www.npmjs.com/package/@coji/zodix)
- [ã‚ªãƒªã‚¸ãƒŠãƒ«ã® Zodix](https://github.com/rileytomasek/zodix)ï¼ˆThanks to Riley Tomasek! ğŸ™ï¼‰
